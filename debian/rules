#!/usr/bin/make -f

# Enable Debian Hardening
# https://wiki.debian.org/Hardening
export DEB_BUILD_MAINT_OPTIONS = hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
# Include all defaults, includes buildflags.mk
include /usr/share/dpkg/default.mk

override_dh_auto_test:
	dh_auto_test -O--no-parallel -- ARGS=--output-on-failure

# Galera Version
ifneq (,$(filter version=%,$(DEB_BUILD_OPTIONS)))
       VERSION = $(filter version=%,$(DEB_BUILD_OPTIONS))
       SCONS_ARGS += $(VERSION)
endif

# Galera revision number
ifneq (,$(filter revno=%,$(DEB_BUILD_OPTIONS)))
       REVNO = $(filter revno=%,$(DEB_BUILD_OPTIONS))
       SCONS_ARGS += $(REVNO)
endif

# Start earlier than MySQL which has value 19
override_dh_installinit-arch:
	dh_installinit -n --name=garb -- defaults 18 22

override_dh_installsystemd:
	dh_installsystemd --name=garb

override_dh_shlibdeps:
	dh_shlibdeps --dpkg-shlibdeps-params=--ignore-missing-info

%:

	dh $@ --list-missing
